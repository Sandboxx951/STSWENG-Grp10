  <!DOCTYPE html>
  <html lang="en">

  <head>
      <meta charset="UTF-8">
      <title>Courses</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" type="text/css" href="css/StyleCourses.css">
      <script src="StyleCourses.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
          integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>

  <body>
      <div class="navbar">
          <div class="logo">
              <img src="logo.png" alt="Logo">
          </div>
          <ul>
              <li><a href="/">Home</a></li>
              <li><a href="Profile.html">You</a></li>
          </ul>
      </div>
      <div class="container">
          <div class="level">General Finance Courses</div>
          <div class="unlock">
              Unlock Your Potential with Gwendolyn Parker: Whether you're aiming for Real<br>
              Estate Success or Financial Fluency, we've got your back.
          </div>

          <div class="what">What are you looking for?</div>

          <div class="slider">
            <input type="radio" name="testimonial" id="t-1">
            <input type="radio" name="testimonial" id="t-2">
            <input type="radio" name="testimonial" id="t-3" checked>
            <input type="radio" name="testimonial" id="t-4">
            <input type="radio" name="testimonial" id="t-5">
            
            <div class="testimonials">
                <label class="item" for="t-1">
                    <a href="">
                        <img src="test picture 2.png" alt="Image 1">
                    </a>
                </label>
                <label class="item" for="t-2">
                    <a href="https://www.youtube.com/watch?v=WEDIj9JBTC8">
                        <img src="test picture 2.png" alt="Image 2">
                    </a>
                </label>
                <label class="item" for="t-3">
                    <a href="https://www.youtube.com/watch?v=WEDIj9JBTC8">
                        <img src="test picture 2.png" alt="Image 3">
                    </a>
                </label>
                <label class="item" for="t-4">
                    <a href="https://www.youtube.com/watch?v=WEDIj9JBTC8">
                        <img src="test picture 2.png" alt="Image 4">
                    </a>
                </label>
                <label class="item" for="t-5">
                    <a href="https://www.youtube.com/watch?v=WEDIj9JBTC8">
                        <img src="test picture 2.png" alt="Image 5">
                    </a>
                </label>
            </div>
        
            <br />
        
            <div class="dots">
                <label for="t-1"></label>
                <label for="t-2"></label>
                <label for="t-3"></label>
                <label for="t-4"></label>
                <label for="t-5"></label>
            </div>
        </div>




      </div>

      <div class="what">List of General Finance Courses:</div>
      <div id="courseList"></div>
  
      <style>
        .course-info span {
            font-size: 30px; /* Small thing to make it bigger for testing */
        }
    
        .modules-list {
            font-size: 20px;
        }
    </style>
      <script>
        async function fetchAndDisplayCourses() {
    try {
        console.log('fetchAndDisplayCourses function called');
        const response = await fetch('/courses/general-finance');
        if (response.ok) {
            const courses = await response.json();
            console.log('Courses:', courses);
            const courseList = document.getElementById('courseList');
            courseList.innerHTML = ''; // Clear previous content
            courses.forEach(async course => {
                const courseElement = document.createElement('div');
                courseElement.className = 'course-row'; // Add class for styling
                courseElement.innerHTML = `
                    <div class="course-info" style="color: white;"> <!-- Added inline style for text color -->
                        <span>${course.courseName} - ${course.courseType} - $${course.price}</span>
                        <button class="purchase-btn" onclick="purchaseCourse(${course.id})">Purchase</button> <!-- Add purchase button -->
                    </div>
                    <div class="modules-list" id="modules-${course.id}"></div> <!-- Container for modules -->
                `;
                courseList.appendChild(courseElement);

                // Fetch and display modules for this course
                const modulesList = document.getElementById(`modules-${course.id}`);
                const modulesResponse = await fetch(`/courses/${course.id}/modules`);
                
                if (modulesResponse.ok) {
                    const modules = await modulesResponse.json();
                    
                    modules.forEach(async module => {
    const moduleElement = document.createElement('div');
    moduleElement.innerHTML = `
        <div style="color: white;">${module.subModuleName}</div>
        <div class="module-content">
            <span class="locked-message" style="color: red; display: none;">Module Locked</span> <!-- Message for locked module -->
            <span class="unlocked-message" style="color: green; display: none;">Module Unlocked</span> <!-- Message for unlocked module -->
            <a class="module-file-link" href="#" style="color: blue; display: none;">View File</a> <!-- Link to view module file -->
        </div>
    `;
    modulesList.appendChild(moduleElement);
    
    // Check if the user has purchased this course
    const userPurchased = await checkUserPurchased(course.id);
    if (userPurchased) {
        const moduleStatusElements = modulesList.querySelectorAll('.module-status');
        const unlockedMessage = modulesList.querySelector('.unlocked-message');
        const lockedMessage = modulesList.querySelector('.locked-message');
        const moduleFileLink = modulesList.querySelector('.module-file-link');
        moduleStatusElements.forEach(element => {
            element.textContent = 'Module Unlocked'; // Update module status
        });
        unlockedMessage.style.display = 'block'; // Display the unlocked message
        moduleFileLink.style.display = 'block'; // Display the module file link
        
        // Set the href attribute of the module file link to the file path
        moduleFileLink.href = module.filePath;
    } else {
        const lockedMessage = modulesList.querySelector('.locked-message');
        lockedMessage.style.display = 'block'; // Display the locked message
    }
});
                    
                    // Check if the user has purchased this course
                    const userPurchased = await checkUserPurchased(course.id);
                    if (userPurchased) {
                        const moduleStatusElements = modulesList.querySelectorAll('.module-status');
                        moduleStatusElements.forEach(element => {
                            element.textContent = 'Module Unlocked'; // Update module status
                        });
                    }
                } else {
                    console.error('Failed to fetch modules:', modulesResponse.statusText);
                }
            });
        } else {
            console.error('Failed to fetch courses:', response.statusText);
        }
    } catch (error) {
        console.error('Error fetching courses:', error);
    }
}

async function checkUserPurchased(courseId) {
    try {
        const response = await fetch(`/courses/${courseId}/purchased`, { method: 'GET' });
        if (response.ok) {
            const result = await response.json();
            return result.purchased; // Returns true if user has purchased the course, false otherwise
        } else {
            console.error('Failed to check if user purchased course:', response.statusText);
            return false;
        }
    } catch (error) {
        console.error('Error checking if user purchased course:', error);
        return false;
    }
}

document.addEventListener('DOMContentLoaded', async function () {
    await fetchAndDisplayCourses();
});

async function purchaseCourse(courseId, userId) {
    try {
        const response = await fetch(`/courses/purchase/${courseId}`, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userId: userId })
        });
        if (response.ok) {
            await fetchAndDisplayCourses(); // Refresh course list
        } else {
            console.error('Failed to purchase course:', response.statusText);
        }
    } catch (error) {
        console.error('Error purchasing course:', error);
    }
}
    </script>
  </body>
  </html>
